{% extends "base.html" %}

{% block title %}Home | Art Discovery Platform{% endblock title %}

{% block content %}
  <!-- Feature Banners -->
  <div class="feature-banners">
    <a href="{{ url_for('wall_stylist') }}" class="feature-banner wall-stylist-banner">
      <div class="banner-icon">🎨</div>
      <div class="banner-content">
        <h3>🌟 AR Wall Stylist</h3>
        <p>Visualize multiple décor options on your wall!</p>
      </div>
      <div class="banner-cta">
        <i class="fas fa-arrow-right"></i>
      </div>
    </a>

    <a href="{{ url_for('crafts_map') }}" class="feature-banner crafts-map-banner">
      <div class="banner-icon">🗺️</div>
      <div class="banner-content">
        <h3>💚 Crafts Map of India</h3>
        <p>Discover state-wise traditional crafts with AR!</p>
      </div>
      <div class="banner-cta">
        <i class="fas fa-arrow-right"></i>
      </div>
    </a>
  </div>

  <section class="feed-header">
    <h2 data-lang-key="featured_artworks">Featured Artworks</h2>
    <p data-lang-key="featured_subtitle">Discover the latest and greatest creations from our global community.</p>
  </section>

  <!-- Filter and Sort Controls -->
  <div class="controls-bar">
    <div class="filter-section">
      <label for="categoryFilter" class="filter-label">
        <i class="fas fa-filter"></i> <span data-lang-key="category">Category</span>:
      </label>
      <select id="categoryFilter" class="filter-select">
        <option value="all">All Categories</option>
        <option value="Pottery">Pottery</option>
        <option value="Woodcraft">Woodcraft</option>
        <option value="Weaving">Weaving</option>
        <option value="Textiles">Textiles</option>
        <option value="Sculpture">Sculpture</option>
        <option value="Painting">Painting</option>
        <option value="Decorative">Decorative</option>
        <option value="Metalwork">Metalwork</option>
        <option value="Jewelry">Jewelry</option>
        <option value="Furniture">Furniture</option>
      </select>
    </div>
    
    <div class="sort-section">
      <label for="sortBy" class="sort-label">
        <i class="fas fa-sort"></i> <span data-lang-key="sort">Sort</span>:
      </label>
      <select id="sortBy" class="sort-select">
        <option value="default">Default</option>
        <option value="price-low">Price: Low to High</option>
        <option value="price-high">Price: High to Low</option>
        <option value="rating">Highest Rated</option>
        <option value="likes">Most Liked</option>
      </select>
    </div>
    
    <div class="view-toggle">
      <button id="gridView" class="view-btn active" title="Grid View">
        <i class="fas fa-th"></i>
      </button>
      <button id="listView" class="view-btn" title="List View">
        <i class="fas fa-list"></i>
      </button>
    </div>
  </div>

  <!-- Art Grid (similar to your old product grid) -->
  <section class="art-grid" id="artGrid">
    {% for art in artworks %}
      <article class="art-card" 
               data-art-id="{{ art.id }}" 
               data-category="{{ art.category }}"
               data-price="{{ art.price }}"
               data-rating="{{ art.rating }}"
               data-likes="{{ art.likes_count }}">
        <!-- Art Image with Glass Overlay -->
        <div class="art-image-wrapper">
          <a href="{{ url_for('art_detail', art_id=art.id) }}">
            <img src="{{ art.image }}" 
                 alt="{{ art.title }} by {{ art.artist }}" 
                 onerror="this.onerror=null;this.src='https://placehold.co/400x300/667eea/ffffff?text=Art+Image';"
                 loading="lazy">
          </a>
          <span class="glass-overlay"></span>
        </div>
        
        <div class="art-content">
          <!-- Title & Artist -->
          <h3 class="art-title">
            <a href="{{ url_for('art_detail', art_id=art.id) }}">{{ art.title }}</a>
          </h3>
          <p class="art-artist"><span data-lang-key="by">by</span> {{ art.artist_name }}</p>
          
          <!-- Rating & Price -->
          <div class="art-meta">
            <div class="rating">
              <i class="fas fa-star" style="color: #FFD700;"></i>
              <span>{{ art.rating }}</span>
            </div>
            <div class="price-tag">
              <span>₹{{ art.price }}</span>
            </div>
          </div>

          <!-- Action Bar -->
          <div class="art-actions">
            <button class="action-btn like-btn {% if art.id in liked_artwork_ids %}liked{% endif %}" 
                    data-art-id="{{ art.id }}" 
                    onclick="toggleLike({{ art.id }}, this)">
              <i class="fas fa-heart"></i>
              <span class="like-count">{{ art.get_likes_count() }}</span>
            </button>
            <a href="{{ url_for('view_in_ar', art_id=art.id) }}" class="btn view-ar-btn" aria-label="View {{ art.title }} in augmented reality">
              <i class="fas fa-cube"></i> <span data-lang-key="view_in_ar">View in AR</span>
            </a>
          </div>
        </div>
      </article>
    {% endfor %}
  </section>

  <script>
    // ========================================
    // FILTER, SORT, AND VIEW TOGGLE
    // ========================================
    const artGrid = document.getElementById('artGrid');
    const categoryFilter = document.getElementById('categoryFilter');
    const sortBy = document.getElementById('sortBy');
    const gridViewBtn = document.getElementById('gridView');
    const listViewBtn = document.getElementById('listView');
    const artCards = Array.from(document.querySelectorAll('.art-card'));

    // Filter by category
    categoryFilter.addEventListener('change', () => {
      const selectedCategory = categoryFilter.value;
      
      artCards.forEach(card => {
        const cardCategory = card.getAttribute('data-category');
        
        if (selectedCategory === 'all' || cardCategory === selectedCategory) {
          card.style.display = 'block';
          card.style.animation = 'fadeIn 0.5s ease';
        } else {
          card.style.display = 'none';
        }
      });
    });

    // Sort artworks
    sortBy.addEventListener('change', () => {
      const sortValue = sortBy.value;
      const visibleCards = artCards.filter(card => card.style.display !== 'none');
      
      let sortedCards = [...visibleCards];
      
      switch(sortValue) {
        case 'price-low':
          sortedCards.sort((a, b) => {
            return parseInt(a.getAttribute('data-price')) - parseInt(b.getAttribute('data-price'));
          });
          break;
        case 'price-high':
          sortedCards.sort((a, b) => {
            return parseInt(b.getAttribute('data-price')) - parseInt(a.getAttribute('data-price'));
          });
          break;
        case 'rating':
          sortedCards.sort((a, b) => {
            return parseFloat(b.getAttribute('data-rating')) - parseFloat(a.getAttribute('data-rating'));
          });
          break;
        case 'likes':
          sortedCards.sort((a, b) => {
            return parseInt(b.getAttribute('data-likes')) - parseInt(a.getAttribute('data-likes'));
          });
          break;
        default:
          // Default order (by ID)
          sortedCards.sort((a, b) => {
            return parseInt(a.getAttribute('data-art-id')) - parseInt(b.getAttribute('data-art-id'));
          });
      }
      
      // Reorder the cards in the DOM
      sortedCards.forEach(card => {
        artGrid.appendChild(card);
      });
    });

    // View toggle (grid/list)
    gridViewBtn.addEventListener('click', () => {
      artGrid.classList.remove('list-view');
      artGrid.classList.add('grid-view');
      gridViewBtn.classList.add('active');
      listViewBtn.classList.remove('active');
    });

    listViewBtn.addEventListener('click', () => {
      artGrid.classList.remove('grid-view');
      artGrid.classList.add('list-view');
      listViewBtn.classList.add('active');
      gridViewBtn.classList.remove('active');
    });

    // Add fadeIn animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
    `;
    document.head.appendChild(style);

    // Initialize grid view
    artGrid.classList.add('grid-view');

    // ========================================
    // LIKE FUNCTIONALITY
    // ========================================
    async function toggleLike(artId, button) {
      {% if not current_user.is_authenticated %}
        showToast('Please login to like artworks', 'error');
        window.location.href = '{{ url_for("login") }}';
        return;
      {% endif %}

      try {
        const response = await fetch(`/api/toggle_like/${artId}`, {
          method: 'POST'
        });
        
        const data = await response.json();
        
        if (data.success) {
          // Toggle liked class
          button.classList.toggle('liked');
          
          // Update like count
          const countSpan = button.querySelector('.like-count');
          if (countSpan) {
            countSpan.textContent = data.likes_count;
          }
          
          // Show toast
          if (data.liked) {
            showToast('Added to favorites!', 'success');
          } else {
            showToast('Removed from favorites', 'info');
          }
        } else {
          showToast('Failed to update like', 'error');
        }
      } catch (error) {
        console.error('Error toggling like:', error);
        showToast('Error updating like', 'error');
      }
    }
  </script>

  <style>
    /* Enhanced Like button styles */
    .art-actions {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .action-btn.like-btn {
      position: relative;
      background: white;
      border: 2px solid #e0e0e0;
      color: #999;
      min-width: 80px;
      height: 40px;
      padding: 0 16px;
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      font-size: 0.9rem;
      font-weight: 600;
    }

    .action-btn.like-btn:hover {
      transform: translateY(-2px) scale(1.05);
      border-color: #ff6b9d;
      color: #ff6b9d;
      box-shadow: 0 4px 16px rgba(255, 107, 157, 0.2);
    }

    .action-btn.like-btn.liked {
      background: linear-gradient(135deg, #ff6b9d 0%, #c94b76 100%);
      border-color: #ff6b9d;
      color: white;
      box-shadow: 0 4px 12px rgba(255, 107, 157, 0.3);
    }

    .action-btn.like-btn.liked:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 6px 20px rgba(255, 107, 157, 0.4);
    }

    .action-btn.like-btn i {
      font-size: 16px;
      transition: transform 0.3s;
    }

    .action-btn.like-btn.liked i {
      animation: heartBeat 0.4s ease;
    }

    @keyframes heartBeat {
      0%, 100% { transform: scale(1); }
      20% { transform: scale(1.4); }
      40% { transform: scale(1.1); }
      60% { transform: scale(1.3); }
      80% { transform: scale(1.05); }
    }

    .action-btn.like-btn .like-count {
      font-size: 0.9rem;
      font-weight: 700;
      letter-spacing: 0.3px;
    }

    /* View in AR button styling */
    .view-ar-btn {
      flex: 1;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%);
      color: white;
      border-radius: 20px;
      font-weight: 600;
      transition: all 0.3s;
      text-decoration: none;
    }

    .view-ar-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
    }

    [data-theme="dark"] .action-btn.like-btn {
      background: var(--card-bg);
      border-color: rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.6);
    }

    [data-theme="dark"] .action-btn.like-btn:hover {
      border-color: #ff6b9d;
      color: #ff6b9d;
    }
  </style>
{% endblock content %}
