{% extends "base.html" %}

{% block title %}Home | Art Discovery Platform{% endblock title %}

{% block content %}
  <!-- Feature Banners -->
  <div class="feature-banners">
    <a href="{{ url_for('wall_stylist') }}" class="feature-banner wall-stylist-banner">
      <div class="banner-icon">🎨</div>
      <div class="banner-content">
        <h3>🌟 AR Wall Stylist</h3>
        <p>Visualize multiple décor options on your wall!</p>
      </div>
      <div class="banner-cta">
        <i class="fas fa-arrow-right"></i>
      </div>
    </a>

    <a href="{{ url_for('crafts_map') }}" class="feature-banner crafts-map-banner">
      <div class="banner-icon">🗺️</div>
      <div class="banner-content">
        <h3>💚 Crafts Map of India</h3>
        <p>Discover state-wise traditional crafts with AR!</p>
      </div>
      <div class="banner-cta">
        <i class="fas fa-arrow-right"></i>
      </div>
    </a>
  </div>

  <section class="feed-header">
    <h2 data-lang-key="featured_artworks">Featured Artworks</h2>
    <p data-lang-key="featured_subtitle">Discover the latest and greatest creations from our global community.</p>
  </section>

  <!-- Filter and Sort Controls -->
  <div class="controls-bar">
    <div class="filter-section">
      <label for="categoryFilter" class="filter-label">
        <i class="fas fa-filter"></i> <span data-lang-key="category">Category</span>:
      </label>
      <select id="categoryFilter" class="filter-select">
        <option value="all">All Categories</option>
        <option value="Pottery">Pottery</option>
        <option value="Woodcraft">Woodcraft</option>
        <option value="Weaving">Weaving</option>
        <option value="Textiles">Textiles</option>
        <option value="Sculpture">Sculpture</option>
        <option value="Painting">Painting</option>
        <option value="Decorative">Decorative</option>
        <option value="Metalwork">Metalwork</option>
        <option value="Jewelry">Jewelry</option>
        <option value="Furniture">Furniture</option>
      </select>
    </div>
    
    <div class="sort-section">
      <label for="sortBy" class="sort-label">
        <i class="fas fa-sort"></i> <span data-lang-key="sort">Sort</span>:
      </label>
      <select id="sortBy" class="sort-select">
        <option value="default">Default</option>
        <option value="price-low">Price: Low to High</option>
        <option value="price-high">Price: High to Low</option>
        <option value="rating">Highest Rated</option>
        <option value="likes">Most Liked</option>
      </select>
    </div>
    
    <div class="view-toggle">
      <button id="gridView" class="view-btn active" title="Grid View">
        <i class="fas fa-th"></i>
      </button>
      <button id="listView" class="view-btn" title="List View">
        <i class="fas fa-list"></i>
      </button>
    </div>
  </div>

  <!-- Art Grid (similar to your old product grid) -->
  <section class="art-grid" id="artGrid">
    {% for art in artworks %}
      <article class="art-card" 
               data-art-id="{{ art.id }}" 
               data-category="{{ art.category }}"
               data-price="{{ art.price }}"
               data-rating="{{ art.rating }}"
               data-likes="{{ art.likes_count }}">
        <!-- Art Image with Glass Overlay -->
        <div class="art-image-wrapper">
          <a href="{{ url_for('art_detail', art_id=art.id) }}">
            <img src="{{ art.image }}" 
                 alt="{{ art.title }} by {{ art.artist }}" 
                 onerror="this.onerror=null;this.src='https://placehold.co/400x300/667eea/ffffff?text=Art+Image';"
                 loading="lazy">
          </a>
          <span class="glass-overlay"></span>
        </div>
        
        <div class="art-content">
          <!-- Title & Artist -->
          <h3 class="art-title">
            <a href="{{ url_for('art_detail', art_id=art.id) }}">{{ art.title }}</a>
          </h3>
          <p class="art-artist"><span data-lang-key="by">by</span> {{ art.artist }}</p>
          
          <!-- Rating & Price -->
          <div class="art-meta">
            <div class="rating">
              <i class="fas fa-star" style="color: #FFD700;"></i>
              <span>{{ art.rating }}</span>
            </div>
            <div class="price-tag">
              <span>₹{{ art.price }}</span>
            </div>
          </div>

          <!-- Action Bar -->
          <div class="art-actions">
            <button class="action-btn like-btn" data-art-id="{{ art.id }}"><i class="fas fa-heart"></i></button>
            <a href="{{ url_for('view_in_ar', art_id=art.id) }}" class="btn view-ar-btn" aria-label="View {{ art.title }} in augmented reality">
              <i class="fas fa-cube"></i> <span data-lang-key="view_in_ar">View in AR</span>
            </a>
          </div>
        </div>
      </article>
    {% endfor %}
  </section>

  <script>
    // ========================================
    // FILTER, SORT, AND VIEW TOGGLE
    // ========================================
    const artGrid = document.getElementById('artGrid');
    const categoryFilter = document.getElementById('categoryFilter');
    const sortBy = document.getElementById('sortBy');
    const gridViewBtn = document.getElementById('gridView');
    const listViewBtn = document.getElementById('listView');
    const artCards = Array.from(document.querySelectorAll('.art-card'));

    // Filter by category
    categoryFilter.addEventListener('change', () => {
      const selectedCategory = categoryFilter.value;
      
      artCards.forEach(card => {
        const cardCategory = card.getAttribute('data-category');
        
        if (selectedCategory === 'all' || cardCategory === selectedCategory) {
          card.style.display = 'block';
          card.style.animation = 'fadeIn 0.5s ease';
        } else {
          card.style.display = 'none';
        }
      });
    });

    // Sort artworks
    sortBy.addEventListener('change', () => {
      const sortValue = sortBy.value;
      const visibleCards = artCards.filter(card => card.style.display !== 'none');
      
      let sortedCards = [...visibleCards];
      
      switch(sortValue) {
        case 'price-low':
          sortedCards.sort((a, b) => {
            return parseInt(a.getAttribute('data-price')) - parseInt(b.getAttribute('data-price'));
          });
          break;
        case 'price-high':
          sortedCards.sort((a, b) => {
            return parseInt(b.getAttribute('data-price')) - parseInt(a.getAttribute('data-price'));
          });
          break;
        case 'rating':
          sortedCards.sort((a, b) => {
            return parseFloat(b.getAttribute('data-rating')) - parseFloat(a.getAttribute('data-rating'));
          });
          break;
        case 'likes':
          sortedCards.sort((a, b) => {
            return parseInt(b.getAttribute('data-likes')) - parseInt(a.getAttribute('data-likes'));
          });
          break;
        default:
          // Default order (by ID)
          sortedCards.sort((a, b) => {
            return parseInt(a.getAttribute('data-art-id')) - parseInt(b.getAttribute('data-art-id'));
          });
      }
      
      // Reorder the cards in the DOM
      sortedCards.forEach(card => {
        artGrid.appendChild(card);
      });
    });

    // View toggle (grid/list)
    gridViewBtn.addEventListener('click', () => {
      artGrid.classList.remove('list-view');
      artGrid.classList.add('grid-view');
      gridViewBtn.classList.add('active');
      listViewBtn.classList.remove('active');
    });

    listViewBtn.addEventListener('click', () => {
      artGrid.classList.remove('grid-view');
      artGrid.classList.add('list-view');
      listViewBtn.classList.add('active');
      gridViewBtn.classList.remove('active');
    });

    // Add fadeIn animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
    `;
    document.head.appendChild(style);

    // Initialize grid view
    artGrid.classList.add('grid-view');
  </script>
{% endblock content %}
